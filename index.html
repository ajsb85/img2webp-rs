<!DOCTYPE html>
<html lang="en" data-color-mode="auto" data-light-theme="light" data-dark-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebP Animation Benchmarks | img2webp-rs</title>

    <!-- Primer CSS - GitHub's Design System -->
    <link href="https://unpkg.com/@primer/css@22.1.0/dist/primer.css" rel="stylesheet" />

    <style>
        :root {
            --card-radius: 12px;
            --material-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.08);
            --material-shadow-hover: 0 10px 20px rgba(0,0,0,0.1), 0 6px 6px rgba(0,0,0,0.05);
        }

        body {
            background-color: var(--color-canvas-subtle);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .Header {
            background-color: var(--color-header-bg);
            color: var(--color-header-text);
            padding: 16px 0;
            border-bottom: 1px solid var(--color-border-default);
        }

        /* Hybrid Card Style: Material Structure + Primer Aesthetics */
        .Box--benchmark {
            border-radius: var(--card-radius) !important;
            border: 1px solid var(--color-border-default);
            box-shadow: var(--material-shadow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: var(--color-canvas-default);
        }

        .Box--benchmark:hover {
            box-shadow: var(--material-shadow-hover);
            transform: translateY(-4px);
            border-color: var(--color-accent-emphasis);
        }

        /* Benchmark Preview Area */
        .preview-container {
            position: relative;
            height: 240px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--color-canvas-inset);
            overflow: hidden;
            background-size: 20px 20px;
            transition: background 0.3s ease;
        }

        /* Transparency Backgrounds */
        .checkered {
            background-image:
                linear-gradient(45deg, var(--color-border-muted) 25%, transparent 25%),
                linear-gradient(-45deg, var(--color-border-muted) 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, var(--color-border-muted) 75%),
                linear-gradient(-45deg, transparent 75%, var(--color-border-muted) 75%);
            background-size: 40px 40px;
            background-position: 0 0, 0 20px, 20px -20px, -20px 0px;
        }
        .image-bg {
            background-image: url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&w=800&q=80');
            background-size: cover;
        }
        .solid-bg { background-color: var(--color-neutral-emphasis-plus); }
        .black-bg { background-color: #000000; }

        .benchmark-img {
            max-width: 85%;
            max-height: 85%;
            object-fit: contain;
            display: block;
        }

        .pixelated { image-rendering: pixelated; }

        .stats-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            background: var(--color-canvas-subtle);
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
            font-size: 12px;
            font-family: var(--fontStack-monospace);
            font-weight: 600;
        }

        .sticky-toolbar {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--color-canvas-default);
            border-bottom: 1px solid var(--color-border-default);
            padding: 12px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .benchmark-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 32px;
            padding: 24px 0;
        }

        .flash-container {
            position: fixed;
            top: 80px;
            right: 24px;
            z-index: 1000;
            min-width: 300px;
        }

        .card-footer {
            padding: 12px 16px;
            border-top: 1px solid var(--color-border-muted);
            background-color: var(--color-canvas-subtle);
            margin-top: auto;
        }

        .tech-box {
            background-color: var(--color-canvas-default);
            border-radius: 12px;
            padding: 32px;
            border: 1px solid var(--color-border-default);
            box-shadow: var(--material-shadow);
        }
    </style>
</head>
<body>

    <header class="Header">
        <div class="container-xl px-3 d-flex flex-items-center">
            <div class="Header-item">
                <a href="https://github.com/ajsb85/img2webp-rs" class="Header-link f2 d-flex flex-items-center">
                    <svg height="32" class="octicon octicon-mark-github mr-2" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                    <span>img2webp-rs</span>
                </a>
            </div>
            <div class="Header-item Header-item--full">
                <nav class="d-flex">
                    <a class="Header-link mr-3" href="https://github.com/ajsb85/img2webp-rs">Repository</a>
                    <a class="Header-link mr-3" href="https://github.com/ajsb85/img2webp-rs/releases">Releases</a>
                    <a class="Header-link" href="#">Benchmarks</a>
                </nav>
            </div>
            <div class="Header-item mr-0">
                <span class="Label Label--secondary">v0.1.0</span>
            </div>
        </div>
    </header>

    <div class="flash-container" id="flash-container"></div>

    <div class="sticky-toolbar">
        <div class="container-xl px-3 d-flex flex-items-center flex-justify-between flex-wrap">
            <div class="d-flex flex-items-center mr-4 py-2">
                <span class="text-bold f6 color-fg-muted mr-3">CANVAS BACKGROUND</span>
                <div class="BtnGroup">
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setBg('checkered')" id="btn-checkered">Checkered</button>
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setBg('image-bg')" id="btn-image">Nature</button>
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setBg('solid-bg')" id="btn-dark">Solid Dark</button>
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setBg('black-bg')" id="btn-black">Black</button>
                </div>
            </div>
            
            <div class="d-flex flex-items-center py-2">
                <span class="text-bold f6 color-fg-muted mr-3">RENDERING</span>
                <div class="BtnGroup">
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setRendering('smooth')" id="btn-smooth">Standard</button>
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setRendering('pixelated')" id="btn-pixel">Pixel Perfect</button>
                </div>
            </div>
        </div>
    </div>

    <main class="container-xl px-3 pt-6 pb-8">
        <div class="Subhead mb-4">
            <div class="Subhead-heading f0-light">Optimization Benchmarks</div>
            <div class="Subhead-description">Comparing 7 distinct encoding strategies for transparent WebP animations.</div>
        </div>

        <div class="benchmark-grid">
            <!-- 1. Standard -->
            <div class="Box Box--benchmark">
                <div class="preview-container checkered">
                    <img src="animated.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Standard</h3>
                    <p class="color-fg-muted f6">The baseline baseline behavior. Reliable industry standard.</p>
                    <div class="stats-badge mt-3">1.31 MB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">Default</code>
                </div>
            </div>

            <!-- 2. Pixel Perfect -->
            <div class="Box Box--benchmark">
                <div class="preview-container checkered">
                    <img src="animated_perfect.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Pixel Perfect</h3>
                    <p class="color-fg-muted f6">Preserves RGB data in Alpha=0 pixels to prevent edge bleeding.</p>
                    <div class="stats-badge mt-3">1.40 MB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-lossless -exact</code>
                </div>
            </div>

            <!-- 3. Extreme Slow -->
            <div class="Box Box--benchmark">
                <div class="preview-container checkered">
                    <img src="animated_slowest.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Extreme Slow</h3>
                    <p class="color-fg-muted f6">Maximum exhaustive search (M6) for the smallest possible bitstream.</p>
                    <div class="stats-badge mt-3">1.38 MB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-m 6 -alpha_filter 2</code>
                </div>
            </div>

            <!-- 4. Optimized Small -->
            <div class="Box Box--benchmark border-accent shadow-medium">
                <div class="preview-container checkered">
                    <img src="animated_small.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2 color-fg-accent">Optimized Small</h3>
                    <p class="color-fg-muted f6">Mixed-mode with reduced alpha quality. Recommended for web assets.</p>
                    <div class="stats-badge color-bg-accent-emphasis color-fg-on-emphasis mt-3">203 KB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-mixed -alpha_q 50</code>
                </div>
            </div>

            <!-- 5. Near Lossless -->
            <div class="Box Box--benchmark">
                <div class="preview-container checkered">
                    <img src="animated_near_lossless60.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Near Lossless</h3>
                    <p class="color-fg-muted f6">Perceptual optimization that alters pixels for high compression ratios.</p>
                    <div class="stats-badge mt-3">895 KB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-near_lossless 60</code>
                </div>
            </div>

            <!-- 6. Lossy Sharp -->
            <div class="Box Box--benchmark">
                <div class="preview-container checkered">
                    <img src="animated_lossy.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Lossy Sharp</h3>
                    <p class="color-fg-muted f6">High contrast preservation using Sharp YUV conversion.</p>
                    <div class="stats-badge mt-3">209 KB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-lossy -q 75 -sharp_yuv</code>
                </div>
            </div>

            <!-- 7. Lossy Low -->
            <div class="Box Box--benchmark">
                <div class="preview-container checkered">
                    <img src="animated_lossy_low.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Lossy Low</h3>
                    <p class="color-fg-muted f6">Minimal footprint for bandwidth-starved environments.</p>
                    <div class="stats-badge mt-3">125 KB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-q 30 -alpha_q 30</code>
                </div>
            </div>
        </div>

        <!-- Technical Deep Dive Section -->
        <div class="mt-8">
            <div class="Subhead mb-4">
                <div class="Subhead-heading">Technical Architecture & Benchmark Analysis</div>
            </div>
            
            <div class="tech-box markdown-body">
                <h3>1. Core Architecture: The Rust Migration</h3>
                <p>
                    The <code>img2webp-rs</code> utility represents a fundamental shift from the original C implementation to a memory-safe, enterprise-grade Rust workspace. The architecture is split into two specialized components:
                </p>
                <ul>
                    <li><strong><code>webp_anim</code> (Core Library):</strong> A safe Rust abstraction layer over <code>libwebp-sys</code>. It manages the low-level FFI calls to the WebP Animation API, handling complex pointer orchestration, ABI versioning, and memory cleanup through Rust's <code>Drop</code> trait.</li>
                    <li><strong><code>img2webp</code> (CLI Driver):</strong> A stateful command-line interface that implements a two-pass argument parser. This allows the tool to interleave frame-specific configurations (like quality and duration) with input files, exactly mimicking the original utility's behavior while adding modern safety.</li>
                </ul>

                <h3>2. Encoding Pipeline & Image Handling</h3>
                <p>
                    Unlike the original tool which relies on internal C decoders, <code>img2webp-rs</code> utilizes the high-performance <strong>Rust <code>image</code> crate</strong>. This enables support for a significantly broader range of source formats (BMP, TIFF, etc.) while ensuring that every pixel is processed through a safe, audited decoding pipeline before reaching the WebP encoder.
                </p>

                <h3>3. Advanced Parameter Logic</h3>
                <p>
                    The benchmarks above utilize several critical WebP features that we have exposed via the CLI:
                </p>
                <table>
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Technical Role</th>
                            <th>Impact on Results</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>-exact</code></td>
                            <td>RGB Preservation</td>
                            <td>Prevents the encoder from zeroing out color data in Alpha=0 pixels. This is the difference between <strong>Pixel Perfect</strong> and <strong>Standard</strong> transparency.</td>
                        </tr>
                        <tr>
                            <td><code>-alpha_filter</code></td>
                            <td>Spatial Prediction</td>
                            <td>Uses advanced algorithms (None, Fast, Best) to predict alpha values based on surrounding pixels, significantly reducing entropy in complex transparency masks.</td>
                        </tr>
                        <tr>
                            <td><code>-m 6</code></td>
                            <td>Search Complexity</td>
                            <td>Enables the highest level of exhaustive search for the optimal bitstream representation. It results in the smallest files for a given quality level but requires significant CPU time.</td>
                        </tr>
                        <tr>
                            <td><code>-near_lossless</code></td>
                            <td>Pre-processing</td>
                            <td>A perceptual filter that slightly modifies pixel values to make them more "compressible" without visible changes to the human eye.</td>
                        </tr>
                    </tbody>
                </table>

                <h3>4. Benchmark Analysis</h3>
                <p>
                    The comparison results reveal a significant variance in efficiency:
                </p>
                <ul>
                    <li><strong>Fidelity vs. Size:</strong> The <code>Pixel Perfect</code> version is the largest (~1.40 MB) because it stores "invisible" data. For production UI, this is often necessary to avoid interpolation artifacts.</li>
                    <li><strong>The "Sweet Spot":</strong> The <code>Optimized Small</code> version (~203 KB) achieves an <strong>~85% reduction</strong> in size. This is accomplished by using <code>-mixed</code> mode, which allows the encoder to choose Lossy for complex textures and Lossless for sharp edges on a per-frame basis.</li>
                    <li><strong>Low-Bandwidth Strategy:</strong> The <code>Lossy Low</code> version (~125 KB) demonstrates the floor of WebP animation. While artifacts are visible, it remains a viable option for massive image sequences in restricted environments.</li>
                </ul>
            </div>
        </div>
    </main>

    <footer class="footer mt-auto py-6 border-top color-bg-subtle">
        <div class="container-xl px-3 d-flex flex-justify-between flex-items-center">
            <div class="d-flex flex-items-center">
                <svg height="24" class="octicon octicon-mark-github mr-3 color-fg-muted" viewBox="0 0 16 16" version="1.1" width="24"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                <span class="f6 color-fg-muted">&copy; 2026 img2webp-rs project. Hybrid Design (Material + Primer).</span>
            </div>
            <nav class="d-flex">
                <a class="Link--secondary f6" href="https://github.com/ajsb85/img2webp-rs">Source Code</a>
            </nav>
        </div>
    </footer>

    <script>
        function showFlash(message) {
            const container = document.getElementById('flash-container');
            const flash = document.createElement('div');
            flash.className = 'flash flash-success mb-3 shadow-sm anim-fade-in';
            flash.style.borderRadius = '8px';
            flash.innerHTML = `
                <svg class="octicon octicon-check" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>
                ${message}
            `;
            container.appendChild(flash);
            setTimeout(() => { 
                flash.style.opacity = '0'; 
                flash.style.transform = 'translateX(20px)';
                setTimeout(() => flash.remove(), 500); 
            }, 2000);
        }

        function setBg(cls) {
            document.querySelectorAll('.preview-container').forEach(el => {
                el.className = 'preview-container ' + cls;
            });
            document.querySelectorAll('.BtnGroup [id^="btn-"]').forEach(btn => btn.classList.remove('btn-primary'));
            const idMap = { 'checkered': 'btn-checkered', 'image-bg': 'btn-image', 'solid-bg': 'btn-dark', 'black-bg': 'btn-black' };
            const active = document.getElementById(idMap[cls]);
            if (active) active.classList.add('btn-primary');
            showFlash(`Background: ${cls.replace('-', ' ')}`);
        }

        function setRendering(cls) {
            document.querySelectorAll('.benchmark-img').forEach(el => {
                el.className = 'benchmark-img ' + cls;
            });
            document.getElementById('btn-smooth').classList.toggle('btn-primary', cls === 'smooth');
            document.getElementById('btn-pixel').classList.toggle('btn-primary', cls === 'pixelated');
            showFlash(`Engine: ${cls === 'smooth' ? 'Standard' : 'Pixel Perfect'}`);
        }

        // Initialize defaults
        setBg('checkered');
        setRendering('smooth');
    </script>
</body>
</html>