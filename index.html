<!DOCTYPE html>
<html lang="en" data-color-mode="auto" data-light-theme="light" data-dark-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebP Animation Benchmarks | img2webp-rs</title>

    <!-- Primer CSS - GitHub's Design System -->
    <link href="https://unpkg.com/@primer/css@22.1.0/dist/primer.css" rel="stylesheet" />

    <style>
        :root {
            --card-radius: 12px;
            /* Material 3 inspired elevation */
            --shadow-1: 0 1px 2px rgba(0,0,0,0.1);
            --shadow-2: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-3: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            
            /* High-contrast checkered pattern colors */
            --checkered-light: #ffffff;
            --checkered-dark: #e1e4e8;
        }

        [data-color-mode="dark"] :root {
            --checkered-light: #161b22;
            --checkered-dark: #30363d;
        }

        body {
            background-color: var(--color-canvas-subtle);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .Header {
            background-color: var(--color-header-bg);
            border-bottom: 1px solid var(--color-border-default);
        }

        /* Hybrid Card: Material Depth + Primer Precision */
        .Box--benchmark {
            background-color: var(--color-canvas-default);
            border-radius: var(--card-radius) !important;
            border: 1px solid var(--color-border-default);
            box-shadow: var(--shadow-2);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .Box--benchmark:hover {
            box-shadow: var(--shadow-3);
            transform: translateY(-6px);
            border-color: var(--color-accent-emphasis);
        }

        /* Benchmark Preview: The Transparency Stage */
        .preview-stage {
            position: relative;
            height: 260px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--color-canvas-inset);
            overflow: hidden;
            border-bottom: 1px solid var(--color-border-muted);
            transition: all 0.4s ease;
        }

        /* FIX: Robust Checkered Background */
        .checkered {
            background-color: var(--checkered-light);
            background-image: 
                linear-gradient(45deg, var(--checkered-dark) 25%, transparent 25%), 
                linear-gradient(-45deg, var(--checkered-dark) 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, var(--checkered-dark) 75%), 
                linear-gradient(-45deg, transparent 75%, var(--checkered-dark) 75%);
            background-size: 32px 32px;
            background-position: 0 0, 0 16px, 16px -16px, -16px 0px;
        }

        .image-bg {
            background-image: url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&w=800&q=80');
            background-size: cover;
            background-position: center;
        }
        .solid-bg { background-color: var(--color-neutral-emphasis-plus); }
        .black-bg { background-color: #000000; }

        .benchmark-img {
            max-width: 85%;
            max-height: 85%;
            object-fit: contain;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.15));
            transition: transform 0.3s ease;
        }

        .pixelated { image-rendering: pixelated; }

        /* Meta components */
        .stats-pill {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            background: var(--color-accent-subtle);
            color: var(--color-accent-fg);
            border: 1px solid var(--color-accent-border);
            border-radius: 100px;
            font-size: 12px;
            font-family: var(--fontStack-monospace);
            font-weight: 600;
        }

        .sticky-toolbar {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--color-canvas-default);
            border-bottom: 1px solid var(--color-border-default);
            padding: 12px 0;
            box-shadow: var(--shadow-1);
        }

        .benchmark-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 32px;
            padding: 32px 0;
        }

        .card-footer {
            padding: 12px 16px;
            background-color: var(--color-canvas-subtle);
            border-top: 1px solid var(--color-border-muted);
            margin-top: auto;
        }

        .flash-container {
            position: fixed;
            top: 80px;
            right: 24px;
            z-index: 1000;
            pointer-events: none;
        }

        .tech-card {
            background-color: var(--color-canvas-default);
            border-radius: 16px;
            border: 1px solid var(--color-border-default);
            box-shadow: var(--shadow-2);
        }
    </style>
</head>
<body>

    <header class="Header">
        <div class="container-xl px-3 d-flex flex-items-center">
            <div class="Header-item">
                <a href="https://github.com/ajsb85/img2webp-rs" class="Header-link f2 d-flex flex-items-center">
                    <svg height="32" class="octicon octicon-mark-github mr-2" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                    <span>img2webp-rs</span>
                </a>
            </div>
            <div class="Header-item Header-item--full">
                <nav class="d-flex">
                    <a class="Header-link mr-3" href="https://github.com/ajsb85/img2webp-rs">Source</a>
                    <a class="Header-link mr-3" href="https://github.com/ajsb85/img2webp-rs/releases">Releases</a>
                    <a class="Header-link" href="#">Documentation</a>
                </nav>
            </div>
            <div class="Header-item mr-0">
                <span class="Label Label--secondary">v0.1.0</span>
            </div>
        </div>
    </header>

    <div class="flash-container" id="flash-container"></div>

    <div class="sticky-toolbar">
        <div class="container-xl px-3 d-flex flex-items-center flex-justify-between flex-wrap">
            <div class="d-flex flex-items-center mr-4 py-2">
                <span class="text-bold f6 color-fg-muted mr-3">PREVIEW CONTEXT</span>
                <div class="BtnGroup">
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setBg('checkered')" id="btn-checkered">Checkered</button>
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setBg('image-bg')" id="btn-image">Nature</button>
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setBg('solid-bg')" id="btn-dark">Dark Blue</button>
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setBg('black-bg')" id="btn-black">Solid Black</button>
                </div>
            </div>
            
            <div class="d-flex flex-items-center py-2">
                <span class="text-bold f6 color-fg-muted mr-3">ENGINE</span>
                <div class="BtnGroup">
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setRendering('smooth')" id="btn-smooth">Standard</button>
                    <button class="btn BtnGroup-item btn-sm" type="button" onclick="setRendering('pixelated')" id="btn-pixel">Pixel Perfect</button>
                </div>
            </div>
        </div>
    </div>

    <main class="container-xl px-3 pt-6 pb-8">
        <div class="Subhead mb-4 border-bottom-0">
            <div class="Subhead-heading f0-light">Transparency Optimization</div>
            <div class="Subhead-description">A deep-dive comparison of 7 encoding strategies for animated transparent assets.</div>
        </div>

        <div class="benchmark-grid">
            <!-- 1. Standard -->
            <div class="Box Box--benchmark">
                <div class="preview-stage checkered">
                    <img src="animated.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Standard</h3>
                    <p class="color-fg-muted f6">Industry baseline. Efficient but may discard "invisible" RGB data.</p>
                    <div class="stats-pill mt-3">1.31 MB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">Default</code>
                </div>
            </div>

            <!-- 2. Pixel Perfect -->
            <div class="Box Box--benchmark">
                <div class="preview-stage checkered">
                    <img src="animated_perfect.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Pixel Perfect</h3>
                    <p class="color-fg-muted f6">Preserves raw RGB data even at 0% Alpha. Zero color bleeding.</p>
                    <div class="stats-pill mt-3">1.40 MB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-lossless -exact</code>
                </div>
            </div>

            <!-- 3. Extreme Slow -->
            <div class="Box Box--benchmark">
                <div class="preview-stage checkered">
                    <img src="animated_slowest.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Extreme Slow</h3>
                    <p class="color-fg-muted f6">CPU-intensive search (M6) for the absolute smallest bitstream.</p>
                    <div class="stats-pill mt-3">1.38 MB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-m 6 -alpha_filter 2</code>
                </div>
            </div>

            <!-- 4. Optimized Small -->
            <div class="Box Box--benchmark border-accent shadow-medium">
                <div class="preview-stage checkered">
                    <img src="animated_small.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2 color-fg-accent">Optimized Small</h3>
                    <p class="color-fg-muted f6">The sweet spot. Mixed mode with intelligent alpha optimization.</p>
                    <div class="stats-pill color-bg-accent-emphasis color-fg-on-emphasis mt-3" style="border:none">203 KB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-mixed -alpha_q 50</code>
                </div>
            </div>

            <!-- 5. Near Lossless -->
            <div class="Box Box--benchmark">
                <div class="preview-stage checkered">
                    <img src="animated_near_lossless60.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Near Lossless</h3>
                    <p class="color-fg-muted f6">Subtle pixel pre-processing for massive compression gains.</p>
                    <div class="stats-pill mt-3">895 KB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-near_lossless 60</code>
                </div>
            </div>

            <!-- 6. Lossy Sharp -->
            <div class="Box Box--benchmark">
                <div class="preview-stage checkered">
                    <img src="animated_lossy.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Lossy Sharp</h3>
                    <p class="color-fg-muted f6">High-contrast preservation using Sharp YUV algorithm.</p>
                    <div class="stats-pill mt-3">209 KB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-lossy -q 75 -sharp_yuv</code>
                </div>
            </div>

            <!-- 7. Lossy Low -->
            <div class="Box Box--benchmark">
                <div class="preview-stage checkered">
                    <img src="animated_lossy_low.webp" class="benchmark-img">
                </div>
                <div class="Box-body p-4">
                    <h3 class="f4 mb-2">Lossy Low</h3>
                    <p class="color-fg-muted f6">Bandwidth-first strategy. High artifacts, minimal footprint.</p>
                    <div class="stats-pill mt-3">125 KB</div>
                </div>
                <div class="card-footer">
                    <code class="f6 color-fg-muted">-q 30 -alpha_q 30</code>
                </div>
            </div>
        </div>

        <div class="mt-8">
            <div class="Subhead mb-4 border-bottom-0">
                <div class="Subhead-heading">Technical Architecture</div>
            </div>
            
            <div class="tech-card p-6 markdown-body">
                <h3>High-Level Design</h3>
                <p>The <code>img2webp-rs</code> architecture bridges the gap between low-level performance and high-level safety. Built using a modular Rust workspace, it separates concerns into a core encoding engine and a robust CLI driver.</p>
                
                <div class="d-flex flex-column flex-md-row gap-4 mt-4">
                    <div class="Box p-4 flex-1 shadow-sm">
                        <h4 class="mb-2">webp_anim (Library)</h4>
                        <p class="f6 color-fg-muted">Safe abstraction over <code>libwebp-sys</code>. Manages complex pointer math, memory safety, and ABI synchronization.</p>
                    </div>
                    <div class="Box p-4 flex-1 shadow-sm">
                        <h4 class="mb-2">img2webp (CLI)</h4>
                        <p class="f6 color-fg-muted">Stateful 2-pass parser that allows per-frame configuration of quality, duration, and method search effort.</p>
                    </div>
                </div>

                <h3 class="mt-6">Key Optimization Vectors</h3>
                <ul>
                    <li><strong>-exact Preservation:</strong> Essential for professional UI. Prevents the common "dark fringe" issue by keeping RGB data in transparent areas.</li>
                    <li><strong>Alpha Prediction:</strong> Using <code>alpha_filter="best"</code> reduces the entropy of transparency masks, yielding smaller files without losing quality.</li>
                    <li><strong>M6 Search:</strong> The highest complexity setting for the WebP search algorithm, ensuring the absolute most efficient bitstream representation.</li>
                </ul>
            </div>
        </div>
    </main>

    <footer class="footer mt-auto py-8 border-top color-bg-subtle">
        <div class="container-xl px-3 d-flex flex-column flex-md-row flex-justify-between flex-items-center">
            <div class="d-flex flex-items-center mb-4 mb-md-0">
                <svg height="24" class="octicon octicon-mark-github mr-3 color-fg-muted" viewBox="0 0 16 16" version="1.1" width="24"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                <span class="f6 color-fg-muted">&copy; 2026 img2webp-rs. Architecture by ajsb85.</span>
            </div>
            <nav class="d-flex">
                <a class="Link--secondary f6 mr-4" href="https://github.com/ajsb85/img2webp-rs">Source Code</a>
                <a class="Link--secondary f6" href="https://github.com/ajsb85/img2webp-rs/releases">Latest Release</a>
            </nav>
        </div>
    </footer>

    <script>
        function showFlash(message) {
            const container = document.getElementById('flash-container');
            const flash = document.createElement('div');
            flash.className = 'flash flash-success mb-3 shadow-medium anim-fade-in p-3 border-accent';
            flash.style.borderRadius = '12px';
            flash.style.background = 'var(--color-canvas-default)';
            flash.innerHTML = `
                <div class="d-flex flex-items-center">
                    <svg class="octicon octicon-check mr-2 color-fg-success" viewBox="0 0 16 16" version="1.1" width="16" height="16"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>
                    <span class="f5 text-bold">${message}</span>
                </div>
            `;
            container.appendChild(flash);
            setTimeout(() => { 
                flash.style.opacity = '0'; 
                flash.style.transform = 'translateY(-10px)';
                setTimeout(() => flash.remove(), 500); 
            }, 2500);
        }

        function setBg(cls) {
            document.querySelectorAll('.preview-stage').forEach(el => {
                el.className = 'preview-stage ' + cls;
            });
            document.querySelectorAll('.BtnGroup [id^="btn-"]').forEach(btn => btn.classList.remove('btn-primary'));
            const idMap = { 'checkered': 'btn-checkered', 'image-bg': 'btn-image', 'solid-bg': 'btn-dark', 'black-bg': 'btn-black' };
            const active = document.getElementById(idMap[cls]);
            if (active) active.classList.add('btn-primary');
            showFlash(`Preview updated: ${cls.toUpperCase()}`);
        }

        function setRendering(cls) {
            document.querySelectorAll('.benchmark-img').forEach(el => {
                el.className = 'benchmark-img ' + cls;
            });
            document.getElementById('btn-smooth').classList.toggle('btn-primary', cls === 'smooth');
            document.getElementById('btn-pixel').classList.toggle('btn-primary', cls === 'pixelated');
            showFlash(`Engine: ${cls === 'smooth' ? 'STANDARD' : 'PIXEL PERFECT'}`);
        }

        // Initialize defaults
        setBg('checkered');
        setRendering('smooth');
    </script>
</body>
</html>
